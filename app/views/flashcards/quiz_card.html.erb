
<% translations = Translation.where(learning_path_id: @learning_path_id) %>
<% filtered_translations = translations.where(review_status: 0).or(translations.where(review_status:1)) %>
<% card = filtered_translations.sample %>
<% phrase = Expression.find(card.expression_in_target_language_id) %>
<% correct_translation = Expression.find(card.expression_in_base_language_id) %>
<% translations = Array.new %>
<% translations.push(correct_translation) %>
<% 4.times do %>
<% incorrect_translation = Expression.all.sample %>
<% translations.push(incorrect_translation) %>
<% end %>


<!-- bootstrap this -->
<div class="container mt-4">
  <div class="card">
    <div class="card-body">
      <div class="mb-3">
        <p>Translate the phrase:</p>
      </div>
      <div id="the_phrase" data-phrase-id="<%= phrase.id %>">
        <%= phrase.body %>
      </div>
      <audio id="audioPlayer" controls></audio>
      <button id="playButton" class="btn btn-primary">Play Translation</button>
    </div>
  </div>
</div>

  <%= link_to "show_quiz_results", remote: true do %>
    <input type="hidden" id="correct_translation" value="<%= correct_translation.body %>">
    <input type="hidden" id="phrase_untranslated" value="<%= phrase.body %>">
    <button id="flip-button" class="btn btn-primary mt-3">Flip</button>
  <% end %>

  <form action="/translations/<%= card.id %>/update_status" method="post">
  <input type="hidden" name="_method" value="post">
  
  <label for="review_status">Review Status:</label>
  <select id="review_status" name="review_status">
    <option value="0">Need to Review</option>
    <option value="1">Wouldn't mind reviewing</option>
    <option value="2">Don't want to see again</option>
  </select>
  
  <button type="submit">Update Status</button>
</form>

  <%= link_to flashcards_show_quiz_results_path(learning_path_id:@learning_path_id), class: "btn btn-success mt-3" do %>
    Next
  <% end %>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
$(document).ready(function () {
  $(document).ready(function () {
  $('#playButton').on('click', function () {
    var phrase = $('#the_phrase').text();

    // Make an AJAX call to your Rails controller
    $.ajax({
      url: '/tts',
      method: 'POST',
      data: JSON.stringify({ text: phrase }),
      contentType: 'application/json',
      xhrFields: {
        responseType: 'blob'
      },
      success: function (data) {
        // Create a new audio element
        var audioPlayer = new Audio();

        // Create a Blob from the binary audio data
        var blob = new Blob([data], { type: 'audio/mp3' });

        // Set the audio source using a Blob
        audioPlayer.src = URL.createObjectURL(blob);

        // Ensure playback within a user interaction context
        document.body.addEventListener('click', function() {
          audioPlayer.play().catch(function(error) {
            console.error('Error playing audio:', error);
          });
        }, { once: true });
      },
      error: function (error) {
        console.error('Error fetching audio:', error);
      }
    });
  });
});
})
</script>
